const inventory = [
  {
    price: 55000,
    sizeOptions: ['TALLA UNICA'],
    colorOptions: [
      '#0F1014',
      '#A5171F',
      '#ABAFB8',
      '#FEDADB',
      '#690F1B',
      '#132626',
      '#A24550',
      '#CB7D1B',
      '#7B3724',
      '#DDDFDC',
    ],
    name: 'Buso botón',
    category: 'busos',
    img: '/productos-liamty/buso-botón.jpg',
    img2: '/large-images/buso-botón-large.jpg',
  },
  {
    name: 'Buso clásico',
    category: 'busos',
    price: 55000,
    sizeOptions: ['TALLA UNICA'],
    colorOptions: [
      '#B8BAB9',
      '#182C2C',
      '#BF6A5A',
      '#101012',
      '#53181C',
      '#FAF8E9',
      '#E8B943',
    ],
    img: '/productos-liamty/buso-clasico.jpg',
    img2: '/large-images/buso-clasico-large.jpg',
  },
  {
    name: 'Buso cuadros',
    category: 'busos',
    price: 55000,
    sizeOptions: ['TALLA UNICA'],
    colorOptions: [
      '#5F1129',
      '#8F4E56',
      '#E7AA57',
      '#A2192D',
      '#1F3E43',
      '#965247',
      '#8E97A6',
      '#EBEFF1',
      '#F0C3CA',
      '#0B0C10',
      '#BDB9B0',
    ],
    img: '/productos-liamty/buso-cuadros.jpg',
    img2: '/large-images/buso-cuadros-large.jpg',
  },
  {
    name: 'Buso hombro',
    category: 'busos',
    price: 55000,
    sizeOptions: ['TALLA UNICA'],
    colorOptions: [
      '#C79F95',
      '#121117',
      '#254239',
      '#8A8F92',
      '#CFCEB9',
      '#47090C',
      '#9C564C',
      '#BC8743',
    ],
    img: '/productos-liamty/buso-hombro.jpg',
    img2: '/large-images/buso-hombro-large.jpg',
  },
  {
    name: 'Buso maya',
    category: 'busos',
    price: 60000,
    sizeOptions: ['TALLA UNICA'],
    colorOptions: [
      '#0B090A',
      '#602121',
      '#CEA29F',
      '#4A0911',
      '#7C7D82',
      '#BF7A28',
    ],
    img: '/productos-liamty/buso-maya.jpg',
    img2: '/large-images/buso-maya-large.jpg',
  },
  {
    name: 'Buso trenza',
    category: 'busos',
    price: 55000,
    sizeOptions: ['TALLA UNICA'],
    colorOptions: [
      '#07090D',
      '#E29D4C',
      '#853A3A',
      '#5B0313',
      '#9EA8B1',
      '#E3E4D6',
      '#282D40',
      '#A97C76',
    ],
    img: '/productos-liamty/buso-trenza.jpg',
    img2: '/large-images/buso-trenza-large.jpg',
  },
  {
    name: 'Gabán botón',
    category: 'gabanes',
    price: 65000,
    sizeOptions: ['TALLA UNICA'],
    colorOptions: [
      '#08080A',
      '#97A1AA',
      '#EAA355',
      '#F6E8DD',
      '#9A424E',
      '#480B12',
    ],
    img: '/productos-liamty/gabán-botón.jpg',
    img2: '/large-images/gabán-botón-large.jpg',
  },
  {
    name: 'Gabán combinado',
    category: 'gabanes',
    price: 65000,
    sizeOptions: ['TALLA UNICA'],
    colorOptions: [
      '#0B090A',
      '#602121',
      '#CEA29F',
      '#4A0911',
      '#7C7D82',
      '#BF7A28',
    ],
    img: '/productos-liamty/gabán-combinado.jpg',
    img2: '/large-images/gabán-combinado-large.jpg',
  },
  {
    name: 'Vestido unicolor',
    category: 'vestidos',
    price: 60000,
    sizeOptions: ['TALLA UNICA'],
    colorOptions: [
      '#5F1129',
      '#8F4E56',
      '#E7AA57',
      '#A2192D',
      '#1F3E43',
      '#965247',
      '#8E97A6',
      '#EBEFF1',
      '#F0C3CA',
      '#0B0C10',
      '#BDB9B0',
    ],
    img: '/productos-liamty/vestido-unicolor.jpg',
    img2: '/large-images/vestido-unicolor-large.jpg',
  },
  {
    name: 'Gabán kimono',
    category: 'gabanes',
    price: 65000,
    sizeOptions: ['TALLA UNICA'],
    colorOptions: [
      '#18333C',
      '#E72952',
      '#61162B',
      '#D48F2F',
      '#E8E7E5',
      '#E9B6B5',
      '#9A4751',
      '#1A181B',
      '#A1A9AC',
    ],
    img: '/productos-liamty/gabán-kimono.jpg',
    img2: '/large-images/gabán-kimono-large.jpg',
  },
  {
    name: 'Vestido botón',
    category: 'vestidos',
    price: 80000,
    sizeOptions: ['TALLA UNICA'],
    colorOptions: ['#07090D', '#E29D4C', '#B1545D', '#5B0313', '#9EA8B1'],
    img: '/productos-liamty/vestido-botón.jpg',
    img2: '/large-images/vestido-botón-large.jpg',
  },
  {
    name: 'Vestido raya',
    category: 'vestidos',
    price: 75000,
    sizeOptions: ['TALLA UNICA'],
    colorOptions: [
      '#111322',
      '#9A1319',
      '#DDB4BA',
      '#621421',
      '#153B3E',
      '#A8525F',
      '#DC9521',
    ],
    img: '/productos-liamty/vestido-raya.jpg',
    img2: '/large-images/vestido-raya-large.jpg',
  },
  {
    name: 'Buso cuello caído',
    category: 'busos',
    price: 60000,
    sizeOptions: ['TALLA UNICA'],
    colorOptions: [
      '#5F1129',
      '#8F4E56',
      '#E7AA57',
      '#A2192D',
      '#1F3E43',
      '#965247',
      '#8E97A6',
      '#EBEFF1',
      '#F0C3CA',
      '#0B0C10',
      '#BDB9B0',
    ],
    img: '/productos-liamty/buso-cuello-caído.jpg',
    img2: '/large-images/buso-cuello-caído-large.jpg',
  },
  {
    name: 'Buso cuello tortuga',
    category: 'busos',
    price: 50000,
    sizeOptions: ['TALLA UNICA'],
    colorOptions: [
      '#0F1014',
      '#FBD3D3',
      '#F4F6F5',
      '#AE1620',
      '#E2962D',
      '#9FAEB8',
      '#7B3929',
      '#3C4843',
      '#894246',
      '#C7BBAF',
    ],
    img: '/productos-liamty/buso-cuello-tortuga.jpg',
    img2: '/large-images/buso-cuello-tortuga-large.jpg',
  },
  {
    name: 'Vestido cuello caído',
    category: 'vestidos',
    price: 75000,
    sizeOptions: ['TALLA UNICA'],
    colorOptions: [
      '#A40818',
      '#96433B',
      '#131315',
      '#CA8C1F',
      '#919A9A',
      '#7F3F23',
      '#0B322F',
      '#560619',
    ],
    img: '/productos-liamty/vestido-cuello-caído.jpg',
    img2: '/large-images/vestido-cuello-caído-large.jpg',
  },
];

//formatthe size options into an array.
const sizeOptionsArray = [].concat(
  ...inventory.map((product) => product.sizeOptions),
);

//take the size options array, delete repeated info and format the data to pass it properly to sql library.

const sizeOptionsSet = [...new Set(sizeOptionsArray)].map((option) => {
  return { size_option_name: option };
});
//formatthe color options into an array.
const colorOptionsArray = [].concat(
  ...inventory.map((product) => product.colorOptions),
);

//take the size options array, delete repeated info and format the data to pass it properly to sql library.

const colorOptionsSet = [...new Set(colorOptionsArray)].map((option) => {
  return { color_option_name: option };
});

exports.up = async (sql) => {
  await sql`
	INSERT INTO product ${sql(
    inventory,
    'name',
    'category',
    'price',
    'img',
    'img2',
  )}`;

  await sql`
  INSERT INTO size_options ${sql(sizeOptionsSet, 'size_option_name')}`;

  await sql`
  INSERT INTO color_options ${sql(colorOptionsSet, 'color_option_name')}`;

  const sizesOnDatabase = await sql`
  SELECT * FROM size_options`;

  const colorsOnDatabase = await sql`
  SELECT * FROM color_options`;

  const productNamesOnDatabase = await sql`
  SELECT id,name FROM product`;

  //create an object whit product name : ID
  const productNameToDataBaseID = {};
  [...productNamesOnDatabase].forEach((obj) => {
    productNameToDataBaseID[obj.name] = obj.id;
  });

  //create an object whit sizes name : ID
  const sizeOptToDataBaseID = {};
  [...sizesOnDatabase].forEach((obj) => {
    sizeOptToDataBaseID[obj.size_option_name] = obj.id;
  });

  //create an array of arrays whit [[objId, [objectZisesIds]], ...]
  const sizesJunctionTableData = inventory.map((obj) => [
    productNameToDataBaseID[obj.name],
    obj.sizeOptions.map((sizeOpt) => sizeOptToDataBaseID[sizeOpt]),
  ]);

  //Create Junction table valuePairs Looping over the junctionTablData and then Looping into the array whit idZises,
  for (const data of sizesJunctionTableData) {
    for (const sizeId of data[1]) {
      await sql`
INSERT INTO product_sizes VALUES (${data[0]}, ${sizeId})`;
    }
  }

  //create an object whit color name : ID
  const colorsOnDatabaseID = {};
  [...colorsOnDatabase].forEach((obj) => {
    colorsOnDatabaseID[obj.color_option_name] = obj.id;
  });

  //create an array of arrays whit [[objId, [objectColorsIds]], ...]
  const colorsJunctionTableData = inventory.map((obj) => [
    productNameToDataBaseID[obj.name],
    obj.colorOptions.map((colorOption) => colorsOnDatabaseID[colorOption]),
  ]);

  //Create Junction table valuePairs Looping over the colorsJunctionTableData and then Looping into the array whit colorIds,
  for (const data of colorsJunctionTableData) {
    for (const colorId of data[1]) {
      await sql`
  INSERT INTO product_colors VALUES (${data[0]}, ${colorId})`;
    }
  }
};

exports.down = async (sql) => {
  for (const item of inventory) {
    await sql`
    DELETE FROM product_sizes;
  `;
    await sql`
      DELETE FROM product_colors;
    `;
    await sql`
      DELETE FROM product WHERE
        name = ${item.name} AND
        img = ${item.img};
		`;
    await sql`
      DELETE FROM size_options;
    `;
    await sql`
      DELETE FROM color_options;
    `;
  }
};
